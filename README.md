# Siren-net

一个基于Reactor的高性能网络库Siren-Net，siren是一种美丽而危险的生物，Siren-Net旨在为用户提供高效而迷人的网络库。提供可靠、高效的网络编程解决方案，为开发人员构建高性能的网络应用提供支持。
### 特性
1. 用户无需关注网络库底层等细节，只需处理对应的事件，就可以完成网络应用的编写
2. 使用 `epoll(7)`实现多路复用
3. 支持多线程 Reactor 和 单线程 Reactor 模式，不支持多进程 Reactor
4. 支持使用线程池进行业务逻辑的处理
5. 支持异步任务，支持定时器
6. 不支持 UDP，只支持 TCP
7. 使用C++ 11、14、17完成

### 依赖
本项目主要依赖两个第三方库：fmt（格式化文本）、spdlog（高性能日志库）


### 注意
现版本存在恶性BUG，可能会有内存泄漏、使用了悬空指针等问题，后续会排查修复

### 性能

经过测试，本项目的性能在大文件传输时性能能好于muduo网络库，其性能对比如下：

我们采用 PingPong 作为测试方法。当消息体较小时（小于10M），当消息体大小为100KB的时候，吞吐量较高。当消息体较大的时候，我们发现siren-net对于小数据包传输速率不如muduo，对于较大的消息体的传输效率比muduo更好。




|            | 次数  | 1KB    | 10KB   | 100KB   | 1M      | 10M     |
| ---------- | ---- | ------ | ------ | ------- | ------- | ------- |
| siren (MiB)| Avg | 677.8  | 5675.4 | 6058.8  | 3704    | 12012.6 |
|            | 1    | 715    | 5654   | 6209    | 4001    | 10,497  |
|            | 2    | 680    | 5810   | 6155    | 3829    | 14,332  |
|            | 3    | 684    | 5641   | 5713    | 3640    | 11,532  |
|            | 4    | 686    | 5590   | 5996    | 3210    | 10,024  |
|            | 5    | 624    | 5682   | 6221    | 3840    | 13,678  |
| muduo (MiB)| Avg | 836.2  | 6413.6 | 5904    | 3644    | 10974.4 |
|            | 1    | 846    | 6778   | 5882    | 3819    | 11,286  |
|            | 2    | 775    | 5832   | 5709    | 3820    | 11,110  |
|            | 3    | 779    | 6388   | 5794    | 3647    | 9,644   |
|            | 4    | 954    | 6845   | 6111    | 3107    | 10,150  |
|            | 5    | 827    | 6225   | 6024    | 3827    | 12,682  |
| 性能百分比  |      | 81.06% | 88.49% | 102.62% | 101.65% | 109.46% |

性能百分比为：siren性能/muduo性能 x 100%
后续会添加与其他网络库的比对结果，如asio，netty。

测试机器：
CPU: Intel 11800H 8 core
内存：16GB ddr4 3200MHz

### 后续的优化：

1. Timestamp：首先更改timestamp基础类，原先是直接使用的C++ 11的chrono的system_clock作为时间戳。其可能有两个问题：
   1. 性能，调用system_clock可能会涉及系统调用，其开销较高，这也导致了在传输文件体较小的情况下，其性能较muduo较差。或尝试其他获取时间的API
   2. 时间回转，system_clock调用的是系统时间，若是改变了系统时间，system_clock也会受其影响，而依赖他的timestamp也会受影响
2. Timer：现在的定时器以及定时器集合TimerQueue设计不够理想，时间复杂度可能较高，还缺乏cancel等方法。
   1. 使用小根堆或者时间轮算法替代现在使用的set<Timer*>
   2. 使用弱回调技术完成cancel，使得能够在O(1)复杂度下完成cancel
3. 无锁队列：现在使用的消费者-生产者模型主要使用的mutex作为同步原语，部分场景下可能其开销可能较大。如果使用原子类，CAS操作实现无锁队列完善消费者-生产者模型，其高压性能应该能再优化点











